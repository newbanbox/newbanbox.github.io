<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多功能在线工具集</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #2ec4b6;
            --warning-color: #ff9f1c;
            --danger-color: #e71d36;
            --gray-color: #6c757d;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: #f5f7ff;
            color: var(--dark-color);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* 头部样式 */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--box-shadow);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 0.5rem;
            color: var(--accent-color);
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 1.5rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
        }

        .nav-links a:hover {
            color: var(--accent-color);
        }

        /* 英雄区域 */
        .hero {
            text-align: center;
            padding: 3rem 1rem;
            background: white;
            border-radius: 0 0 10px 10px;
            box-shadow: var(--box-shadow);
            margin-bottom: 2rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .hero p {
            font-size: 1.2rem;
            color: var(--gray-color);
            max-width: 800px;
            margin: 0 auto;
        }

        /* 工具网格 */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .tool-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .tool-card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            text-align: center;
        }

        .tool-card-header i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .tool-card-header h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .tool-card-body {
            padding: 1.5rem;
        }

        .tool-card-body p {
            color: var(--gray-color);
            margin-bottom: 1.5rem;
        }

        .tool-btn {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            text-decoration: none;
        }

        .tool-btn:hover {
            background: var(--secondary-color);
        }

        /* 页脚 */
        footer {
            background: var(--dark-color);
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .footer-links {
            display: flex;
            list-style: none;
            margin: 1rem 0;
        }

        .footer-links li {
            margin: 0 1rem;
        }

        .footer-links a {
            color: var(--accent-color);
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 工具模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 800px;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-secondary {
            background: var(--gray-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* 预览区域 */
        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }

        .preview-box {
            flex: 1;
            min-width: 250px;
            text-align: center;
        }

        .preview-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .download-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 15px;
            background: var(--success-color);
            color: white;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 500;
        }

        .download-btn:hover {
            background: #25a89c;
        }

        .result-container {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 10px;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: inline-block;
            vertical-align: middle;
            margin-left: 10px;
        }

        .controls-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        canvas {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* 工作流样式 */
        #workflow-canvas {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .workflow-toolbox {
            position: absolute;
            left: 10px;
            top: 100px;
            width: 150px;
            background: white;
            border-radius: 5px;
            box-shadow: var(--box-shadow);
            padding: 10px;
            z-index: 100;
        }

        .workflow-tool {
            padding: 8px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: move;
            text-align: center;
        }

        .workflow-tool:hover {
            background: #e9ecef;
        }

        .workflow-properties {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        /* 视频播放器样式 */
        .video-js {
            width: 100%;
            height: 300px;
            margin-bottom: 20px;
        }

        /* PDF预览区域 */
        .pdf-preview {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        /* 性能优化：懒加载 */
        .lazy-load {
            opacity: 0;
            transition: opacity 0.3s;
        }

        .lazy-load.loaded {
            opacity: 1;
        }

        /* 文本区域 */
        .text-area {
            width: 100%;
            height: 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            resize: vertical;
        }
    </style>
</head>

<body>
    <!-- 导航栏 -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <i class="fas fa-tools"></i>
                    <span>工具百宝箱</span>
                </div>
                <ul class="nav-links">
                    <li><a href="#">所有工具</a></li>
                    <li><a href="https://newban.cn/">关于</a></li>
                    <li><a href="https://newban.cn/">联系</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container">
        <!-- 英雄区域 -->
        <section class="hero">
            <h1>一站式实用工具集合</h1>
            <p>免费、便捷的在线小工具，提高您的工作和学习效率。持续更新中...</p>
        </section>

        <!-- 工具网格 -->
        <section id="tools">
            <h2 style="text-align: center; margin-bottom: 2rem; color: var(--secondary-color);">可用工具</h2>
            <div class="tools-grid">
                <!-- 工具卡片 1: 图片转Word -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-file-word"></i>
                        <h3>图片转Word</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>将图片中的内容转换为可编辑的Word文档，支持多种图片格式。</p>
                        <button class="tool-btn" onclick="openTool('imageToWord')">使用工具</button>
                    </div>
                </div>
                <!-- 新增工具卡片 1: 二维码生成 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-qrcode"></i>
                        <h3>二维码生成</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>生成自定义二维码，支持文本、URL、联系方式等多种内容。</p>
                        <button class="tool-btn" onclick="openTool('qrGenerator')">使用工具</button>
                    </div>
                </div>

                <!-- 新增工具卡片 2: 图片无损压缩 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-compress-arrows-alt"></i>
                        <h3>图片无损压缩</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>压缩图片大小而不损失质量，支持PNG、JPG、WEBP格式。</p>
                        <button class="tool-btn" onclick="openTool('imageCompressor')">使用工具</button>
                    </div>
                </div>


                <!-- 工具卡片 2: 图片尺寸调整 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-expand-arrows-alt"></i>
                        <h3>图片尺寸调整</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>调整图片尺寸，支持保持宽高比和多种尺寸预设选项。</p>
                        <button class="tool-btn" onclick="openTool('imageResize')">使用工具</button>
                    </div>
                </div>

                <!-- 工具卡片 3: 图片添加水印 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-tint"></i>
                        <h3>图片添加水印</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>为图片添加文字或图片水印，保护您的版权和内容。</p>
                        <button class="tool-btn" onclick="openTool('watermark')">使用工具</button>
                    </div>
                </div>

                <!-- 工具卡片 4: 复利计算器 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-calculator"></i>
                        <h3>复利计算器</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>计算复利投资收益，帮助您做出更明智的投资决策。</p>
                        <button class="tool-btn" onclick="openTool('compoundInterest')">使用工具</button>
                    </div>
                </div>

                <!-- 工具卡片 5: m3u8视频下载 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-download"></i>
                        <h3>m3u8视频下载</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>下载m3u8视频流并转换为MP4格式，支持批量下载。</p>
                        <button class="tool-btn" onclick="openTool('m3u8Downloader')">使用工具</button>
                    </div>
                </div>

                <!-- 工具卡片 6: 视频转换 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-film"></i>
                        <h3>视频转换</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>转换视频格式，支持MP4、AVI、MOV等格式。</p>
                        <button class="tool-btn" onclick="openTool('videoConverter')">使用工具</button>
                    </div>
                </div>

                <!-- 工具卡片 7: PDF工具包 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-file-pdf"></i>
                        <h3>PDF工具包</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>PDF合并、分割、压缩和转换工具。</p>
                        <button class="tool-btn" onclick="openTool('pdfTools')">使用工具</button>
                    </div>
                </div>

                <!-- 工具卡片 8: LRC转SRT -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-music"></i>
                        <h3>LRC转SRT</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>将LRC歌词文件转换为SRT字幕文件。</p>
                        <button class="tool-btn" onclick="openTool('lrcToSrt')">使用工具</button>
                    </div>
                </div>

                <!-- 工具卡片 9: 文本加密解密 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-lock"></i>
                        <h3>文本加密解密</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>使用AES算法加密和解密文本内容。</p>
                        <button class="tool-btn" onclick="openTool('textEncrypt')">使用工具</button>
                    </div>
                </div>
                <!--  短链生成 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-link"></i>
                        <h3>短链生成</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>将长URL转换为短链接，方便分享和使用。</p>
                        <button class="tool-btn" onclick="openTool('urlShortener')">使用工具</button>
                    </div>
                </div>
                <!-- 工具卡片 10: 工作流系统（放在最后） -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-project-diagram"></i>
                        <h3>工作流系统</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>创建和管理自动化工作流程，可视化任务编排。</p>
                        <button class="tool-btn" onclick="openTool('workflowSystem')">使用工具</button>
                    </div>
                </div>
                <!-- 更多工具卡片可以按照这个模板添加 -->
                <div class="tool-card">
                    <div class="tool-card-header">
                        <i class="fas fa-plus-circle"></i>
                        <h3>更多工具</h3>
                    </div>
                    <div class="tool-card-body">
                        <p>我们持续开发更多实用工具，敬请期待！</p>
                        <button class="tool-btn" disabled>即将上线</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2025 工具百宝箱. 所有权利保留.</p>
                <ul class="footer-links">
                    <li><a href="https://newban.cn/">隐私政策</a></li>
                    <li><a href="https://newban.cn/">使用条款</a></li>
                    <li><a href="https://newban.cn/">反馈建议</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <!-- 工具模态框 -->
    <div id="toolModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <h2 id="modalTitle">工具名称</h2>
            </div>
            <div id="modalBody">
                <!-- 工具内容会动态加载到这里 -->
            </div>
        </div>
    </div>
    <!-- 引入必要的JS库 -->
    <script src="https://fastly.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://fastly.jsdelivr.net/npm/video.js@7.11.4/dist/video.min.js"></script>
    <script src="https://unpkg.com/bpmn-js@8.7.1/dist/bpmn-viewer.development.js"></script>
    <script src="https://fastly.jsdelivr.net/npm/tesseract.js@v2.1.0/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs@gh-pages/qrcode.min.js"></script>
    <script>
        // 全局变量
        let currentTool = null;
        let watermarkPreviewImage = null;
        let watermarkPreviewCanvas = null;
        let watermarkPreviewCtx = null;
        let hlsPlayer = null;
        let workflowViewer = null;
        let pdfDoc = null;

        // 打开工具模态框
        function openTool(toolType) {
            currentTool = toolType;
            const modal = document.getElementById('toolModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            // 根据工具类型设置模态框内容和标题
            switch (toolType) {
                case 'imageToWord':
                    modalTitle.textContent = '图片转Word工具';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="imageUpload">上传图片</label>
                            <input type="file" id="imageUpload" accept="image/*">
                        </div>
                        <div class="form-group">
                            <label for="outputFormat">输出格式</label>
                            <select id="outputFormat">
                                <option value="docx">DOCX (Word文档)</option>
                                <option value="pdf">PDF</option>
                                <option value="txt">纯文本</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="processImage()">转换</button>
                        </div>
                        <div class="loading" id="ocrLoading" style="display: none;">
                            <div class="spinner"></div>
                            <p>正在识别图片中的文字...</p>
                            <div class="progress-container">
                                <div class="progress-bar" id="ocrProgress"></div>
                            </div>
                        </div>
                        <div id="imageToWordResult" class="result-container" style="display: none;">
                            <h3>转换结果</h3>
                            <div id="textPreview" style="margin: 15px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; max-height: 200px; overflow-y: auto;"></div>
                            <a id="downloadText" class="download-btn" href="#" download="extracted_text.txt">下载文本</a>
                        </div>
                    `;
                    break;

                case 'm3u8Downloader':
                    modalTitle.textContent = 'm3u8视频下载器';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="m3u8Url">m3u8视频URL</label>
                            <input type="url" id="m3u8Url" placeholder="输入m3u8视频地址" class="lazy-load">
                        </div>
                        <div class="form-group">
                            <label for="videoQuality">视频质量</label>
                            <select id="videoQuality">
                                <option value="auto">自动选择</option>
                                <option value="highest">最高质量</option>
                                <option value="lowest">最低质量</option>
                                <option value="720p">720p</option>
                                <option value="480p">480p</option>
                                <option value="360p">360p</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="loadM3u8Video()">加载视频</button>
                            <button class="btn btn-primary" onclick="downloadM3u8Video()" id="downloadBtn" style="display: none;">下载视频</button>
                        </div>
                        <div class="loading" id="m3u8Loading" style="display: none;">
                            <div class="spinner"></div>
                            <p>正在加载视频...</p>
                        </div>
                        <div id="videoContainer" style="display: none;">
                            <h3>视频预览</h3>
                            <video id="m3u8Video" class="video-js vjs-default-skin" controls preload="auto" width="100%" height="300">
                                <p class="vjs-no-js">
                                    您的浏览器不支持HTML5视频播放器
                                </p>
                            </video>
                            <div id="videoInfo" style="margin-top: 15px;"></div>
                        </div>
                        <div id="downloadProgress" class="progress-container" style="display: none;">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                        <div id="downloadLog" class="log-container" style="display: none;"></div>
                    `;
                    // 延迟加载视频相关资源
                    setTimeout(() => {
                        const lazyElements = document.querySelectorAll('.lazy-load');
                        lazyElements.forEach(el => {
                            el.classList.add('loaded');
                        });
                    }, 300);
                    break;

                case 'workflowSystem':
                    modalTitle.textContent = '工作流系统';
                    modalBody.innerHTML = `
                        <div class="workflow-toolbox">
                            <h4>工具</h4>
                            <div class="workflow-tool" draggable="true" data-type="task">任务</div>
                            <div class="workflow-tool" draggable="true" data-type="decision">决策</div>
                            <div class="workflow-tool" draggable="true" data-type="start">开始</div>
                            <div class="workflow-tool" draggable="true" data-type="end">结束</div>
                        </div>
                        <div id="workflow-canvas"></div>
                        <div class="form-group">
                            <label for="workflowName">工作流名称</label>
                            <input type="text" id="workflowName" placeholder="输入工作流名称">
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="saveWorkflow()">保存工作流</button>
                            <button class="btn btn-primary" onclick="exportWorkflow()">导出工作流</button>
                            <button class="btn btn-primary" onclick="executeWorkflow()">执行工作流</button>
                        </div>
                        <div class="workflow-properties" id="workflowProperties" style="display: none;">
                            <h4>属性</h4>
                            <div id="propertiesContent"></div>
                        </div>
                        <div id="executionResult" class="result-container" style="display: none;">
                            <h4>执行结果</h4>
                            <div id="resultContent"></div>
                        </div>
                    `;
                    // 初始化工作流编辑器
                    setTimeout(initWorkflowEditor, 100);
                    break;
                case 'imageResize':
                    modalTitle.textContent = '图片尺寸调整';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="resizeImageUpload">上传图片</label>
                            <input type="file" id="resizeImageUpload" accept="image/*" onchange="handleResizeImageUpload(event)">
                        </div>
                        <div class="controls-row">
                            <div class="control-group">
                                <label for="width">宽度 (像素)</label>
                                <input type="number" id="width" placeholder="输入宽度" oninput="updateResizePreview()">
                            </div>
                            <div class="control-group">
                                <label for="height">高度 (像素)</label>
                                <input type="number" id="height" placeholder="输入高度" oninput="updateResizePreview()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="maintainAspect" checked onchange="updateResizePreview()"> 保持宽高比
                            </label>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="downloadResizedImage()">下载图片</button>
                        </div>
                        <div class="loading" id="resizeLoading" style="display: none;">
                            <div class="spinner"></div>
                            <p>正在处理图片...</p>
                        </div>
                        <div id="resizePreview" class="preview-container" style="display: none;">
                            <div class="preview-box">
                                <div class="preview-title">原始图片</div>
                                <img id="originalPreview" class="preview-image" src="" alt="原始图片">
                            </div>
                            <div class="preview-box">
                                <div class="preview-title">调整后图片</div>
                                <canvas id="resizedCanvas" class="preview-image"></canvas>
                                <a id="downloadResized" class="download-btn" href="#" download="resized_image.png" style="display: none;">下载图片</a>
                            </div>
                        </div>
                    `;
                    break;

                case 'watermark':
                    modalTitle.textContent = '图片添加水印';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="watermarkImageUpload">上传图片</label>
                            <input type="file" id="watermarkImageUpload" accept="image/*" onchange="handleWatermarkImageUpload(event)">
                        </div>
                        <div class="form-group">
                            <label for="watermarkText">水印文字</label>
                            <input type="text" id="watermarkText" placeholder="输入水印文字" value="Watermark" oninput="updateWatermarkPreview()">
                        </div>
                        
                        <div class="controls-row">
                            <div class="control-group">
                                <label for="watermarkColor">水印颜色</label>
                                <input type="color" id="watermarkColor" value="#ffffff" onchange="updateWatermarkPreview()">
                            </div>
                            <div class="control-group">
                                <label for="watermarkOpacity">不透明度</label>
                                <div class="slider-container">
                                    <input type="range" id="watermarkOpacity" min="1" max="10" value="5" oninput="updateWatermarkPreview()">
                                    <span class="slider-value" id="opacityValue">5</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="controls-row">
                            <div class="control-group">
                                <label for="watermarkFontSize">字体大小</label>
                                <div class="slider-container">
                                    <input type="range" id="watermarkFontSize" min="10" max="100" value="30" oninput="updateWatermarkPreview()">
                                    <span class="slider-value" id="fontSizeValue">30</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="watermarkRotation">旋转角度</label>
                                <div class="slider-container">
                                    <input type="range" id="watermarkRotation" min="-45" max="45" value="0" oninput="updateWatermarkPreview()">
                                    <span class="slider-value" id="rotationValue">0°</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="watermarkPosition">水印位置</label>
                            <select id="watermarkPosition" onchange="updateWatermarkPreview()">
                                <option value="center">居中</option>
                                <option value="top-left">左上角</option>
                                <option value="top-right">右上角</option>
                                <option value="bottom-left">左下角</option>
                                <option value="bottom-right">右下角</option>
                                <option value="diagonal">对角线</option>
                                <option value="tiled">平铺</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="downloadWatermarkedImage()">下载图片</button>
                        </div>
                        
                        <div class="loading" id="watermarkLoading" style="display: none;">
                            <div class="spinner"></div>
                            <p>正在添加水印...</p>
                        </div>
                        
                        <div id="watermarkPreview" class="preview-container" style="display: none;">
                            <div class="preview-box">
                                <div class="preview-title">原始图片</div>
                                <img id="originalWatermarkPreview" class="preview-image" src="" alt="原始图片">
                            </div>
                            <div class="preview-box">
                                <div class="preview-title">水印图片</div>
                                <canvas id="watermarkCanvas" class="preview-image"></canvas>
                                <a id="downloadWatermarked" class="download-btn" href="#" download="watermarked_image.png" style="display: none;">下载图片</a>
                            </div>
                        </div>
                    `;
                    break;

                case 'compoundInterest':
                    modalTitle.textContent = '复利计算器';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="principal">本金 (元)</label>
                            <input type="number" id="principal" placeholder="输入初始投资金额">
                        </div>
                        <div class="form-group">
                            <label for="rate">年利率 (%)</label>
                            <input type="number" id="rate" step="0.1" placeholder="输入年利率">
                        </div>
                        <div class="form-group">
                            <label for="time">投资年限</label>
                            <input type="number" id="time" placeholder="输入投资年限">
                        </div>
                        <div class="form-group">
                            <label for="compoundFrequency">复利频率</label>
                            <select id="compoundFrequency">
                                <option value="1">每年</option>
                                <option value="2">每半年</option>
                                <option value="4">每季度</option>
                                <option value="12">每月</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="calculateCompoundInterest()">计算</button>
                        </div>
                        <div id="result" class="result-container" style="display: none;">
                            <h3>计算结果</h3>
                            <p id="resultText"></p>
                            <a id="downloadResult" class="download-btn" href="#" download="复利计算结果.txt" style="display: none;">下载结果</a>
                        </div>
                    `;
                    break;



                case 'videoConverter':
                    modalTitle.textContent = '视频格式转换';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="videoFile">上传视频文件</label>
                            <input type="file" id="videoFile" accept="video/*">
                        </div>
                        <div class="form-group">
                            <label for="outputFormat">输出格式</label>
                            <select id="outputFormat">
                                <option value="mp4">MP4</option>
                                <option value="avi">AVI</option>
                                <option value="mov">MOV</option>
                                <option value="gif">GIF</option>
                                <option value="webm">WebM</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="videoQuality">视频质量</label>
                            <select id="videoQuality">
                                <option value="high">高质量</option>
                                <option value="medium">中等质量</option>
                                <option value="low">低质量</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="convertVideo()">转换</button>
                        </div>
                        <div class="loading" id="videoLoading" style="display: none;">
                            <div class="spinner"></div>
                            <p>正在转换视频...</p>
                        </div>
                        <div id="videoResult" class="result-container" style="display: none;">
                            <h3>转换结果</h3>
                            <video id="convertedVideo" controls style="max-width: 100%;"></video>
                            <a id="downloadVideo" class="download-btn" href="#" download="converted_video.mp4">下载视频</a>
                        </div>
                    `;
                    break;

                case 'pdfTools':
                    modalTitle.textContent = 'PDF工具包';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="pdfFiles">上传PDF文件</label>
                            <input type="file" id="pdfFiles" accept=".pdf" multiple>
                        </div>
                        <div class="form-group">
                            <label for="pdfAction">选择操作</label>
                            <select id="pdfAction">
                                <option value="merge">合并PDF</option>
                                <option value="split">分割PDF</option>
                                <option value="compress">压缩PDF</option>
                                <option value="convert">转换为Word</option>
                                <option value="protect">添加密码保护</option>
                            </select>
                        </div>
                        <div id="actionOptions" style="display: none;">
                            <!-- 根据选择的操作显示不同选项 -->
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="processPdf()">执行操作</button>
                        </div>
                        <div class="loading" id="pdfLoading" style="display: none;">
                            <div class="spinner"></div>
                            <p>正在处理PDF文件...</p>
                        </div>
                        <div id="pdfPreview" class="pdf-preview" style="display: none;">
                            <canvas id="pdfCanvas"></canvas>
                        </div>
                        <div id="pdfResult" class="result-container" style="display: none;">
                            <h3>处理结果</h3>
                            <p id="pdfResultText"></p>
                            <a id="downloadPdf" class="download-btn" href="#" download="processed_pdf.pdf">下载结果</a>
                        </div>
                    `;

                    // 监听操作选择变化
                    document.getElementById('pdfAction').addEventListener('change', function () {
                        const action = this.value;
                        const optionsContainer = document.getElementById('actionOptions');
                        optionsContainer.style.display = 'block';

                        let optionsHtml = '';
                        switch (action) {
                            case 'merge':
                                optionsHtml = `
                                    <div class="form-group">
                                        <label>已选择文件: <span id="fileCount">0</span></label>
                                    </div>
                                    <div class="form-group">
                                        <label for="mergeOrder">合并顺序</label>
                                        <select id="mergeOrder">
                                            <option value="filename">按文件名</option>
                                            <option value="upload">按上传顺序</option>
                                        </select>
                                    </div>`;
                                break;
                            case 'split':
                                optionsHtml = `
                                    <div class="form-group">
                                        <label for="splitMethod">分割方式</label>
                                        <select id="splitMethod">
                                            <option value="page">按页码分割</option>
                                            <option value="size">按文件大小分割</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="pageRangeGroup">
                                        <label for="pageRange">页码范围 (例如: 1-5,8,10-12)</label>
                                        <input type="text" id="pageRange" placeholder="输入页码范围">
                                    </div>`;
                                break;
                            case 'compress':
                                optionsHtml = `
                                    <div class="form-group">
                                        <label for="compressionLevel">压缩级别</label>
                                        <select id="compressionLevel">
                                            <option value="low">低压缩 (高质量)</option>
                                            <option value="medium">中等压缩</option>
                                            <option value="high">高压缩 (低质量)</option>
                                        </select>
                                    </div>`;
                                break;
                            case 'convert':
                                optionsHtml = `
                                    <div class="form-group">
                                        <label for="convertFormat">转换格式</label>
                                        <select id="convertFormat">
                                            <option value="docx">Word (.docx)</option>
                                            <option value="txt">纯文本 (.txt)</option>
                                            <option value="image">图片 (.png)</option>
                                        </select>
                                    </div>`;
                                break;
                            case 'protect':
                                optionsHtml = `
                                    <div class="form-group">
                                        <label for="pdfPassword">设置密码</label>
                                        <input type="password" id="pdfPassword" placeholder="输入密码">
                                    </div>
                                    <div class="form-group">
                                        <label for="confirmPassword">确认密码</label>
                                        <input type="password" id="confirmPassword" placeholder="再次输入密码">
                                    </div>`;
                                break;
                        }

                        optionsContainer.innerHTML = optionsHtml;
                    });
                    break;

                case 'lrcToSrt':
                    modalTitle.textContent = 'LRC转SRT工具';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="lrcFile">上传LRC文件</label>
                            <input type="file" id="lrcFile" accept=".lrc">
                        </div>
                        <div class="form-group">
                            <label for="offset">时间偏移 (毫秒)</label>
                            <input type="number" id="offset" value="0">
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="convertLrcToSrt()">转换</button>
                        </div>
                        <div class="loading" id="lrcLoading" style="display: none;">
                            <div class="spinner"></div>
                            <p>正在转换...</p>
                        </div>
                        <div id="lrcResult" class="result-container" style="display: none;">
                            <h3>转换结果</h3>
                            <textarea id="srtPreview" class="text-area"></textarea>
                            <a id="downloadSrt" class="download-btn" href="#" download="converted_subtitle.srt">下载SRT文件</a>
                        </div>
                    `;
                    break;

                case 'textEncrypt':
                    modalTitle.textContent = '文本加密解密';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="textInput">输入文本</label>
                            <textarea id="textInput" class="text-area" placeholder="输入要加密或解密的文本"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="encryptionKey">加密密钥</label>
                            <input type="password" id="encryptionKey" placeholder="输入加密密钥">
                        </div>
                        <div class="form-group">
                            <label for="operation">操作</label>
                            <select id="operation">
                                <option value="encrypt">加密</option>
                                <option value="decrypt">解密</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="processText()">执行</button>
                        </div>
                        <div id="textResult" class="result-container" style="display: none;">
                            <h3>处理结果</h3>
                            <textarea id="resultText" class="text-area"></textarea>
                            <a id="downloadText" class="download-btn" href="#" download="processed_text.txt">下载结果</a>
                        </div>
                    `;
                    break;
                // 二维码生成工具
                case 'qrGenerator':
                    modalTitle.textContent = '二维码生成器';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="qrContent">二维码内容</label>
                            <textarea id="qrContent" class="text-area" placeholder="输入文本、URL或联系方式"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="qrSize">二维码尺寸</label>
                            <select id="qrSize">
                                <option value="128">128x128</option>
                                <option value="256" selected>256x256</option>
                                <option value="512">512x512</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="generateQRCode()">生成二维码</button>
                        </div>
                        <div class="qr-container" id="qrResult" style="display: none;">
                            <h3>生成的二维码</h3>
                            <div id="qrcode"></div>
                            <button class="btn btn-primary" onclick="downloadQRCode()">
                                <i class="fas fa-download"></i> 下载二维码
                            </button>
                        </div>
                    `;
                    break;

                // 图片无损压缩工具
                case 'imageCompressor':
                    modalTitle.textContent = '图片无损压缩';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="compressImage">上传图片</label>
                            <input type="file" id="compressImage" accept="image/*">
                        </div>
                        <div class="form-group">
                            <label for="qualityLevel">压缩质量</label>
                            <select id="qualityLevel">
                                <option value="0.9">高质量 (90%)</option>
                                <option value="0.7" selected>中等质量 (70%)</option>
                                <option value="0.5">低质量 (50%)</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="compressImage()">压缩图片</button>
                        </div>
                        <div class="compression-preview" id="compressionResult" style="display: none;">
                            <div class="preview-item">
                                <h3>原始图片</h3>
                                <img id="originalPreview" class="preview-image">
                                <div id="originalSize" class="size-info"></div>
                            </div>
                            <div class="preview-item">
                                <h3>压缩后图片</h3>
                                <img id="compressedPreview" class="preview-image">
                                <div id="compressedSize" class="size-info"></div>
                                <button class="btn btn-primary" onclick="downloadCompressedImage()">
                                    <i class="fas fa-download"></i> 下载图片
                                </button>
                            </div>
                        </div>
                    `;
                    break;

                // 短链生成工具
                case 'urlShortener':
                    modalTitle.textContent = '短链生成器';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="longUrl">长URL</label>
                            <input type="url" id="longUrl" placeholder="输入需要缩短的URL">
                        </div>
                        <div class="form-group">
                            <label for="customAlias">自定义别名 (可选)</label>
                            <input type="text" id="customAlias" placeholder="输入自定义别名">
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                            <button class="btn btn-primary" onclick="generateShortUrl()">生成短链</button>
                        </div>
                        <div class="shortener-result" id="shortenerResult">
                            <h3>生成的短链</h3>
                            <div class="short-url" id="shortUrl"></div>
                            <button class="btn btn-primary" onclick="copyShortUrl()">
                                <i class="fas fa-copy"></i> 复制短链
                            </button>
                        </div>
                    `;
                    break;
                default:
                    modalBody.innerHTML = `<p>该功能正在开发中，敬请期待！</p>`;
            }

            modal.style.display = 'block';
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('toolModal').style.display = 'none';
            if (hlsPlayer) {
                hlsPlayer.destroy();
                hlsPlayer = null;
            }
            currentTool = null;
        }

        // 点击模态框外部关闭
        window.onclick = function (event) {
            const modal = document.getElementById('toolModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        // m3u8视频加载函数
        function loadM3u8Video() {
            const m3u8Url = document.getElementById('m3u8Url').value;
            if (!m3u8Url) {
                alert('请输入m3u8视频URL');
                return;
            }

            document.getElementById('m3u8Loading').style.display = 'block';
            document.getElementById('videoContainer').style.display = 'none';
            document.getElementById('downloadBtn').style.display = 'none';

            const video = document.getElementById('m3u8Video');

            // 使用HLS.js播放m3u8视频
            if (Hls.isSupported()) {
                const hls = new Hls({
                    maxBufferLength: 30,
                    enableWorker: true,
                    lowLatencyMode: true
                });

                hls.loadSource(m3u8Url);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                    document.getElementById('m3u8Loading').style.display = 'none';
                    document.getElementById('videoContainer').style.display = 'block';
                    document.getElementById('downloadBtn').style.display = 'inline-block';

                    // 显示视频信息
                    const levels = hls.levels;
                    let infoHtml = `<p>视频信息:</p><ul>`;
                    infoHtml += `<li>持续时间: ${Math.round(hls.media.duration)}秒</li>`;
                    if (levels && levels.length > 0) {
                        infoHtml += `<li>可用质量: ${levels.length}种</li>`;
                        levels.forEach((level, index) => {
                            infoHtml += `<li>质量 ${index}: ${level.height}p, ${Math.round(level.bitrate / 1000)}kbps</li>`;
                        });
                    }
                    infoHtml += `</ul>`;
                    document.getElementById('videoInfo').innerHTML = infoHtml;

                    video.play().catch(e => {
                        console.log('自动播放被阻止，需要用户交互', e);
                    });
                });

                hls.on(Hls.Events.ERROR, function (event, data) {
                    console.error('HLS错误:', data);
                    document.getElementById('m3u8Loading').style.display = 'none';
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                alert('网络错误，请检查URL是否正确');
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                alert('媒体错误，视频可能无法播放');
                                break;
                            default:
                                alert('无法加载视频，请检查URL');
                                break;
                        }
                    }
                });

                hlsPlayer = hls;
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Safari原生支持
                video.src = m3u8Url;
                document.getElementById('m3u8Loading').style.display = 'none';
                document.getElementById('videoContainer').style.display = 'block';
                document.getElementById('downloadBtn').style.display = 'inline-block';

                video.addEventListener('loadedmetadata', function () {
                    const infoHtml = `<p>视频信息:</p><ul>
                        <li>持续时间: ${Math.round(video.duration)}秒</li>
                        <li>分辨率: ${video.videoWidth}x${video.videoHeight}</li>
                    </ul>`;
                    document.getElementById('videoInfo').innerHTML = infoHtml;
                });
            } else {
                document.getElementById('m3u8Loading').style.display = 'none';
                alert('您的浏览器不支持HLS视频播放');
            }
        }

        // 下载m3u8视频
        async function downloadM3u8Video() {
            const m3u8Url = document.getElementById('m3u8Url').value;
            if (!m3u8Url) {
                alert('请先加载视频');
                return;
            }

            // 显示下载进度
            document.getElementById('downloadProgress').style.display = 'block';
            const progressBar = document.getElementById('progressBar');
            const downloadLog = document.getElementById('downloadLog');
            progressBar.style.width = '0%';
            downloadLog.style.display = 'block';
            downloadLog.innerHTML = '开始解析m3u8文件...';

            try {
                // 获取m3u8文件内容
                const response = await fetch(m3u8Url);
                if (!response.ok) {
                    throw new Error('获取m3u8文件失败');
                }
                const m3u8Content = await response.text();

                // 解析m3u8文件，获取分片URL
                const segments = parseM3U8(m3u8Content, m3u8Url);
                if (segments.length === 0) {
                    throw new Error('未找到视频分片');
                }

                downloadLog.innerHTML = `找到 ${segments.length} 个视频分片，开始下载...`;
                segmentDownloadProgress = 0;
                segmentDownloadTotal = segments.length;

                // 下载所有分片
                const segmentData = [];
                for (let i = 0; i < segments.length; i++) {
                    try {
                        const segmentUrl = segments[i];
                        downloadLog.innerHTML += `<br>下载分片 ${i + 1}/${segments.length}: ${segmentUrl}`;

                        const segmentResponse = await fetch(segmentUrl);
                        if (!segmentResponse.ok) {
                            throw new Error(`下载分片失败: ${segmentUrl}`);
                        }

                        const arrayBuffer = await segmentResponse.arrayBuffer();
                        segmentData.push(arrayBuffer);

                        // 更新进度
                        segmentDownloadProgress = i + 1;
                        const progress = Math.round((segmentDownloadProgress / segmentDownloadTotal) * 100);
                        progressBar.style.width = `${progress}%`;

                        // 滚动日志到底部
                        downloadLog.scrollTop = downloadLog.scrollHeight;
                    } catch (error) {
                        console.error(`下载分片失败:`, error);
                        downloadLog.innerHTML += `<br>分片下载失败: ${error.message}`;
                    }
                }

                // 合并所有分片
                downloadLog.innerHTML += '<br>所有分片下载完成，正在合并...';

                // 计算总大小
                let totalSize = 0;
                segmentData.forEach(buffer => {
                    totalSize += buffer.byteLength;
                });

                // 创建合并后的ArrayBuffer
                const mergedBuffer = new Uint8Array(totalSize);
                let offset = 0;
                segmentData.forEach(buffer => {
                    mergedBuffer.set(new Uint8Array(buffer), offset);
                    offset += buffer.byteLength;
                });

                // 创建Blob
                const blob = new Blob([mergedBuffer], { type: 'video/mp2t' });

                // 创建下载链接
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'video.mp4';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                downloadLog.innerHTML += '<br>视频合并完成，已开始下载！';
            } catch (error) {
                console.error('下载失败:', error);
                downloadLog.innerHTML += `<br>下载失败: ${error.message}`;
            }
        }

        // 解析m3u8文件
        function parseM3U8(content, baseUrl) {
            const lines = content.split('\n');
            const segments = [];
            let isSegment = false;

            for (let line of lines) {
                line = line.trim();

                if (line.startsWith('#EXTINF:')) {
                    isSegment = true;
                    continue;
                }

                if (isSegment && line && !line.startsWith('#')) {
                    // 处理相对路径
                    let segmentUrl = line;
                    if (!line.startsWith('http')) {
                        const basePath = baseUrl.substring(0, baseUrl.lastIndexOf('/') + 1);
                        segmentUrl = basePath + line;
                    }
                    segments.push(segmentUrl);
                    isSegment = false;
                }
            }

            return segments;
        }

        // 复利计算函数
        function calculateCompoundInterest() {
            const principal = parseFloat(document.getElementById('principal').value);
            const rate = parseFloat(document.getElementById('rate').value) / 100;
            const time = parseFloat(document.getElementById('time').value);
            const frequency = parseFloat(document.getElementById('compoundFrequency').value);

            if (!principal || !rate || !time) {
                alert('请填写所有字段');
                return;
            }

            // 复利计算公式: A = P(1 + r/n)^(nt)
            const amount = principal * Math.pow(1 + rate / frequency, frequency * time);
            const interest = amount - principal;

            const resultText = `
                初始本金: <b>${principal.toFixed(2)}</b> 元<br>
                最终金额: <b>${amount.toFixed(2)}</b> 元<br>
                利息收益: <b>${interest.toFixed(2)}</b> 元
            `;

            document.getElementById('resultText').innerHTML = resultText;
            document.getElementById('result').style.display = 'block';

            // 创建下载链接
            const downloadLink = document.getElementById('downloadResult');
            const blob = new Blob([resultText.replace(/<br>/g, '\n').replace(/<b>/g, '').replace(/<\/b>/g, '')], { type: 'text/plain' });
            downloadLink.href = URL.createObjectURL(blob);
            downloadLink.style.display = 'inline-block';
        }
        // 处理水印图片上传
        function handleWatermarkImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                watermarkPreviewImage = new Image();
                watermarkPreviewImage.src = e.target.result;

                watermarkPreviewImage.onload = function () {
                    // 创建Canvas用于预览
                    watermarkPreviewCanvas = document.getElementById('watermarkCanvas');
                    watermarkPreviewCanvas.width = watermarkPreviewImage.width;
                    watermarkPreviewCanvas.height = watermarkPreviewImage.height;
                    watermarkPreviewCtx = watermarkPreviewCanvas.getContext('2d');

                    // 显示预览区域
                    document.getElementById('watermarkPreview').style.display = 'block';

                    // 显示原始图片
                    document.getElementById('originalWatermarkPreview').src = e.target.result;

                    // 更新水印预览
                    updateWatermarkPreview();
                };
            };
            reader.readAsDataURL(file);
        }

        // 更新水印预览
        function updateWatermarkPreview() {
            if (!watermarkPreviewImage || !watermarkPreviewCanvas || !watermarkPreviewCtx) return;

            // 更新滑块值显示
            document.getElementById('opacityValue').textContent = document.getElementById('watermarkOpacity').value;
            document.getElementById('fontSizeValue').textContent = document.getElementById('watermarkFontSize').value;
            document.getElementById('rotationValue').textContent = document.getElementById('watermarkRotation').value + '°';

            // 清除画布
            watermarkPreviewCtx.clearRect(0, 0, watermarkPreviewCanvas.width, watermarkPreviewCanvas.height);

            // 绘制原始图片
            watermarkPreviewCtx.drawImage(watermarkPreviewImage, 0, 0);

            // 获取水印参数
            const watermarkText = document.getElementById('watermarkText').value;
            const color = document.getElementById('watermarkColor').value;
            const opacity = document.getElementById('watermarkOpacity').value / 10;
            const fontSize = parseInt(document.getElementById('watermarkFontSize').value);
            const rotation = parseInt(document.getElementById('watermarkRotation').value);
            const position = document.getElementById('watermarkPosition').value;

            // 设置水印样式
            watermarkPreviewCtx.font = `bold ${fontSize}px Arial`;
            watermarkPreviewCtx.fillStyle = `rgba(${hexToRgb(color)}, ${opacity})`;
            watermarkPreviewCtx.textAlign = 'center';
            watermarkPreviewCtx.textBaseline = 'middle';

            // 添加水印
            if (watermarkText) {
                if (position === 'tiled') {
                    // 平铺水印
                    addTiledWatermark(watermarkText, rotation, opacity);
                } else if (position === 'diagonal') {
                    // 对角线水印
                    addDiagonalWatermark(watermarkText, rotation, opacity);
                } else {
                    // 单水印
                    addSingleWatermark(watermarkText, position, rotation, opacity);
                }
            }
        }

        // 添加单个水印
        function addSingleWatermark(text, position, rotation, opacity) {
            const canvas = watermarkPreviewCanvas;
            const ctx = watermarkPreviewCtx;

            let x, y;
            switch (position) {
                case 'top-left':
                    x = canvas.width * 0.2;
                    y = canvas.height * 0.2;
                    break;
                case 'top-right':
                    x = canvas.width * 0.8;
                    y = canvas.height * 0.2;
                    break;
                case 'bottom-left':
                    x = canvas.width * 0.2;
                    y = canvas.height * 0.8;
                    break;
                case 'bottom-right':
                    x = canvas.width * 0.8;
                    y = canvas.height * 0.8;
                    break;
                default: // center
                    x = canvas.width / 2;
                    y = canvas.height / 2;
            }

            // 添加旋转水印
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation * Math.PI / 180);
            ctx.fillText(text, 0, 0);
            ctx.restore();
        }

        // 添加平铺水印
        function addTiledWatermark(text, rotation, opacity) {
            const canvas = watermarkPreviewCanvas;
            const ctx = watermarkPreviewCtx;
            const fontSize = parseInt(document.getElementById('watermarkFontSize').value);

            const textWidth = ctx.measureText(text).width;
            const spacingX = textWidth * 1.5;
            const spacingY = fontSize * 2;

            for (let y = 0; y < canvas.height; y += spacingY) {
                for (let x = 0; x < canvas.width; x += spacingX) {
                    ctx.save();
                    ctx.translate(x, y);
                    ctx.rotate(rotation * Math.PI / 180);
                    ctx.fillText(text, 0, 0);
                    ctx.restore();
                }
            }
        }

        // 添加对角线水印
        function addDiagonalWatermark(text, rotation, opacity) {
            const canvas = watermarkPreviewCanvas;
            const ctx = watermarkPreviewCtx;
            const fontSize = parseInt(document.getElementById('watermarkFontSize').value);

            const textWidth = ctx.measureText(text).width;
            const spacing = textWidth * 1.5;

            // 左上到右下
            for (let i = -canvas.width; i < canvas.width * 2; i += spacing) {
                ctx.save();
                ctx.translate(i, i);
                ctx.rotate(rotation * Math.PI / 180);
                ctx.fillText(text, 0, 0);
                ctx.restore();
            }
        }

        // 下载水印图片
        function downloadWatermarkedImage() {
            if (!watermarkPreviewCanvas) {
                alert('请先上传图片并添加水印');
                return;
            }

            const watermarkText = document.getElementById('watermarkText').value;
            if (!watermarkText) {
                alert('请输入水印文字');
                return;
            }

            // 显示下载链接
            const downloadLink = document.getElementById('downloadWatermarked');
            downloadLink.href = watermarkPreviewCanvas.toDataURL('image/png');
            downloadLink.download = `watermarked_${watermarkText}.png`;
            downloadLink.style.display = 'inline-block';
            downloadLink.click();
        }

        // 处理图片尺寸调整上传
        function handleResizeImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const img = new Image();
                img.src = e.target.result;

                img.onload = function () {
                    // 显示预览区域
                    document.getElementById('resizePreview').style.display = 'block';

                    // 显示原始图片
                    document.getElementById('originalPreview').src = e.target.result;

                    // 设置默认尺寸
                    document.getElementById('width').value = img.width;
                    document.getElementById('height').value = img.height;

                    // 更新预览
                    updateResizePreview(img);
                };
            };
            reader.readAsDataURL(file);
        }

        // 更新尺寸调整预览
        function updateResizePreview(img) {
            const fileInput = document.getElementById('resizeImageUpload');
            if (!fileInput.files || fileInput.files.length === 0) return;

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                const img = new Image();
                img.src = e.target.result;

                img.onload = function () {
                    const canvas = document.getElementById('resizedCanvas');
                    const ctx = canvas.getContext('2d');

                    // 获取尺寸参数
                    const widthInput = document.getElementById('width');
                    const heightInput = document.getElementById('height');
                    const maintainAspect = document.getElementById('maintainAspect').checked;

                    let newWidth = parseInt(widthInput.value) || img.width;
                    let newHeight = parseInt(heightInput.value) || img.height;

                    // 保持宽高比
                    if (maintainAspect) {
                        if (widthInput.value && !heightInput.value) {
                            newHeight = (img.height * newWidth) / img.width;
                            heightInput.value = Math.round(newHeight);
                        } else if (!widthInput.value && heightInput.value) {
                            newWidth = (img.width * newHeight) / img.height;
                            widthInput.value = Math.round(newWidth);
                        } else if (widthInput.value && heightInput.value) {
                            const ratio = img.width / img.height;
                            const newRatio = newWidth / newHeight;

                            if (newRatio > ratio) {
                                newHeight = newWidth / ratio;
                                heightInput.value = Math.round(newHeight);
                            } else {
                                newWidth = newHeight * ratio;
                                widthInput.value = Math.round(newWidth);
                            }
                        }
                    }

                    // 设置画布尺寸
                    canvas.width = newWidth;
                    canvas.height = newHeight;

                    // 绘制调整后的图片
                    ctx.drawImage(img, 0, 0, newWidth, newHeight);
                };
            };
            reader.readAsDataURL(file);
        }

        // 下载调整尺寸后的图片
        function downloadResizedImage() {
            const canvas = document.getElementById('resizedCanvas');
            if (!canvas || canvas.width === 0) {
                alert('请先上传图片并调整尺寸');
                return;
            }

            const downloadLink = document.getElementById('downloadResized');
            downloadLink.href = canvas.toDataURL('image/png');
            downloadLink.download = `resized_${canvas.width}x${canvas.height}.png`;
            downloadLink.style.display = 'inline-block';
            downloadLink.click();
        }
        // 图片转文本功能
        function processImage() {
            const fileInput = document.getElementById('imageUpload');

            if (!fileInput.files || fileInput.files.length === 0) {
                alert('请上传图片');
                return;
            }

            const file = fileInput.files[0];
            const outputFormat = document.getElementById('outputFormat').value;

            // 显示加载动画
            document.getElementById('ocrLoading').style.display = 'block';
            document.getElementById('imageToWordResult').style.display = 'none';

            // 使用Tesseract.js进行OCR识别
            Tesseract.recognize(
                file,
                'chi_sim+eng', // 中文简体+英文
                {
                    logger: progress => {
                        if (progress.status === 'recognizing text') {
                            const progressBar = document.getElementById('ocrProgress');
                            progressBar.style.width = `${Math.round(progress.progress * 100)}%`;
                        }
                    }
                }
            ).then(({ data: { text } }) => {
                // 隐藏加载动画
                document.getElementById('ocrLoading').style.display = 'none';

                // 显示提取的文本
                document.getElementById('textPreview').textContent = text;
                document.getElementById('imageToWordResult').style.display = 'block';

                // 创建下载链接
                const downloadLink = document.getElementById('downloadText');
                const blob = new Blob([text], { type: 'text/plain' });
                downloadLink.href = URL.createObjectURL(blob);

                // 根据输出格式设置下载文件名
                let extension = 'txt';
                if (outputFormat === 'docx') extension = 'docx';
                else if (outputFormat === 'pdf') extension = 'pdf';

                downloadLink.download = `extracted_text.${extension}`;
                downloadLink.style.display = 'inline-block';
            }).catch(err => {
                console.error(err);
                alert('文字识别失败，请重试');
                document.getElementById('ocrLoading').style.display = 'none';
            });
        }

        // LRC转SRT功能
        function convertLrcToSrt() {
            const fileInput = document.getElementById('lrcFile');
            const offset = parseInt(document.getElementById('offset').value) || 0;

            if (!fileInput.files || fileInput.files.length === 0) {
                alert('请上传LRC文件');
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            document.getElementById('lrcLoading').style.display = 'block';
            document.getElementById('lrcResult').style.display = 'none';

            reader.onload = function (e) {
                const lrcContent = e.target.result;
                const srtContent = convertLrcToSrtFormat(lrcContent, offset);

                document.getElementById('lrcLoading').style.display = 'none';
                document.getElementById('lrcResult').style.display = 'block';

                document.getElementById('srtPreview').value = srtContent;

                const downloadLink = document.getElementById('downloadSrt');
                const blob = new Blob([srtContent], { type: 'text/plain' });
                downloadLink.href = URL.createObjectURL(blob);
            };

            reader.readAsText(file);
        }

        // LRC转SRT格式转换函数
        function convertLrcToSrtFormat(lrcContent, offset = 0) {
            const lines = lrcContent.split('\n');
            let srtContent = '';
            let counter = 1;
            const lyrics = [];

            // 解析LRC文件
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // 匹配时间标签 [mm:ss.xx]
                const timeRegex = /\[(\d+):(\d+)\.(\d+)\]/g;
                let match;
                const times = [];

                while ((match = timeRegex.exec(line)) !== null) {
                    const minutes = parseInt(match[1]);
                    const seconds = parseInt(match[2]);
                    const milliseconds = parseInt(match[3]) * 10; // 转换为毫秒
                    const timeMs = (minutes * 60 + seconds) * 1000 + milliseconds + offset;
                    times.push(timeMs);
                }

                // 获取歌词文本
                const text = line.replace(timeRegex, '').trim();

                // 为每个时间标签创建歌词条目
                for (const timeMs of times) {
                    lyrics.push({
                        time: timeMs,
                        text: text
                    });
                }
            }

            // 按时间排序
            lyrics.sort((a, b) => a.time - b.time);

            // 生成SRT内容
            for (let i = 0; i < lyrics.length; i++) {
                const startTime = lyrics[i].time;
                let endTime = startTime + 3000; // 默认3秒显示时间

                // 如果有下一个歌词，使用下一个歌词的时间作为结束时间
                if (i < lyrics.length - 1) {
                    endTime = lyrics[i + 1].time;
                }

                // 格式化为SRT时间格式
                const startFormatted = formatSrtTime(startTime);
                const endFormatted = formatSrtTime(endTime);

                // 添加到SRT内容
                srtContent += `${counter++}\n`;
                srtContent += `${startFormatted} --> ${endFormatted}\n`;
                srtContent += `${lyrics[i].text}\n\n`;
            }

            return srtContent;
        }

        // 格式化SRT时间
        function formatSrtTime(milliseconds) {
            const hours = Math.floor(milliseconds / 3600000);
            milliseconds %= 3600000;
            const minutes = Math.floor(milliseconds / 60000);
            milliseconds %= 60000;
            const seconds = Math.floor(milliseconds / 1000);
            const millis = milliseconds % 1000;

            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')},${millis.toString().padStart(3, '0')}`;
        }

        // 文本加密解密功能
        function processText() {
            const text = document.getElementById('textInput').value;
            const key = document.getElementById('encryptionKey').value;
            const operation = document.getElementById('operation').value;

            if (!text) {
                alert('请输入文本');
                return;
            }

            if (!key) {
                alert('请输入加密密钥');
                return;
            }

            let result = '';

            if (operation === 'encrypt') {
                result = encryptText(text, key);
            } else {
                try {
                    result = decryptText(text, key);
                } catch (e) {
                    alert('解密失败，请检查密钥是否正确');
                    return;
                }
            }

            document.getElementById('textResult').style.display = 'block';
            document.getElementById('resultText').value = result;

            const downloadLink = document.getElementById('downloadText');
            const blob = new Blob([result], { type: 'text/plain' });
            downloadLink.href = URL.createObjectURL(blob);
        }

        // 文本加密函数
        function encryptText(text, key) {
            // 简单加密算法实现
            let result = '';
            for (let i = 0; i < text.length; i++) {
                const charCode = text.charCodeAt(i);
                const keyChar = key.charCodeAt(i % key.length);
                const encryptedChar = charCode ^ keyChar;
                result += String.fromCharCode(encryptedChar);
            }
            return btoa(result); // Base64编码
        }
        // 辅助函数：十六进制颜色转RGB
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r}, ${g}, ${b}`;
        }

        // 文本解密函数
        function decryptText(text, key) {
            // Base64解码
            const decoded = atob(text);
            let result = '';
            for (let i = 0; i < decoded.length; i++) {
                const charCode = decoded.charCodeAt(i);
                const keyChar = key.charCodeAt(i % key.length);
                const decryptedChar = charCode ^ keyChar;
                result += String.fromCharCode(decryptedChar);
            }
            return result;
        }

        // 初始化工作流编辑器
        function initWorkflowEditor() {
            const canvas = document.getElementById('workflow-canvas');

            // 使用BPMN.js创建工作流编辑器
            workflowViewer = new BpmnJS({
                container: canvas
            });

            // 创建一个简单的工作流示例
            const initialDiagram = `
                <?xml version="1.0" encoding="UTF-8"?>
                <bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn">
                  <bpmn:process id="Process_1" isExecutable="false">
                    <bpmn:startEvent id="StartEvent_1">
                      <bpmn:outgoing>Flow_1</bpmn:outgoing>
                    </bpmn:startEvent>
                    <bpmn:task id="Task_1">
                      <bpmn:incoming>Flow_1</bpmn:incoming>
                      <bpmn:outgoing>Flow_2</bpmn:outgoing>
                    </bpmn:task>
                    <bpmn:endEvent id="EndEvent_1">
                      <bpmn:incoming>Flow_2</bpmn:incoming>
                    </bpmn:endEvent>
                    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Task_1" />
                    <bpmn:sequenceFlow id="Flow_2" sourceRef="Task_1" targetRef="EndEvent_1" />
                  </bpmn:process>
                  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
                    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">
                      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
                        <dc:Bounds x="173" y="102" width="36" height="36" />
                      </bpmndi:BPMNShape>
                      <bpmndi:BPMNShape id="Task_1_di" bpmnElement="Task_1">
                        <dc:Bounds x="280" y="80" width="100" height="80" />
                      </bpmndi:BPMNShape>
                      <bpmndi:BPMNShape id="EndEvent_1_di" bpmnElement="EndEvent_1">
                        <dc:Bounds x="450" y="102" width="36" height="36" />
                      </bpmndi:BPMNShape>
                      <bpmndi:BPMNEdge id="Flow_1_di" bpmnElement="Flow_1">
                        <di:waypoint x="209" y="120" />
                        <di:waypoint x="280" y="120" />
                      </bpmndi:BPMNEdge>
                      <bpmndi:BPMNEdge id="Flow_2_di" bpmnElement="Flow_2">
                        <di:waypoint x="380" y="120" />
                        <di:waypoint x="450" y="120" />
                      </bpmndi:BPMNEdge>
                    </bpmndi:BPMNPlane>
                  </bpmndi:BPMNDiagram>
                </bpmn:definitions>
            `;

            workflowViewer.importXML(initialDiagram, function (err) {
                if (err) {
                    console.error('Failed to import BPMN diagram', err);
                } else {
                    console.log('BPMN diagram imported successfully');
                }
            });

            // 添加拖拽功能
            setupWorkflowDragAndDrop();
        }

        // 设置工作流拖拽功能
        function setupWorkflowDragAndDrop() {
            const tools = document.querySelectorAll('.workflow-tool');

            tools.forEach(tool => {
                tool.addEventListener('dragstart', function (e) {
                    e.dataTransfer.setData('text/plain', e.target.dataset.type);
                });
            });

            const canvas = document.getElementById('workflow-canvas');
            canvas.addEventListener('dragover', function (e) {
                e.preventDefault();
            });

            canvas.addEventListener('drop', function (e) {
                e.preventDefault();
                const type = e.dataTransfer.getData('text/plain');
                alert(`添加了 ${type} 节点到工作流中。在实际应用中，这里会实现完整的BPMN节点添加逻辑。`);
            });
        }

        // 保存工作流
        function saveWorkflow() {
            const workflowName = document.getElementById('workflowName').value;
            if (!workflowName) {
                alert('请输入工作流名称');
                return;
            }

            workflowViewer.saveXML({ format: true }, function (err, xml) {
                if (err) {
                    console.error('Failed to save workflow', err);
                    alert('保存工作流失败');
                } else {
                    // 在实际应用中，这里会将XML保存到服务器或本地存储
                    localStorage.setItem(`workflow_${workflowName}`, xml);
                    alert(`工作流 "${workflowName}" 已保存成功！`);
                }
            });
        }

        // 导出工作流
        function exportWorkflow() {
            workflowViewer.saveXML({ format: true }, function (err, xml) {
                if (err) {
                    console.error('Failed to export workflow', err);
                    alert('导出工作流失败');
                } else {
                    const blob = new Blob([xml], { type: 'application/xml' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'workflow.bpmn';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }
            });
        }

        // 执行工作流
        function executeWorkflow() {
            document.getElementById('executionResult').style.display = 'block';
            document.getElementById('resultContent').innerHTML = `
                <p>工作流执行中...</p>
                <div class="progress-container">
                    <div class="progress-bar" style="width: 0%"></div>
                </div>
                <ul>
                    <li>开始事件: 执行中</li>
                    <li>任务1: 等待中</li>
                    <li>结束事件: 等待中</li>
                </ul>
            `;

            // 模拟工作流执行过程
            let progress = 0;
            const interval = setInterval(() => {
                progress += 20;
                document.querySelector('.progress-bar').style.width = `${progress}%`;

                if (progress >= 100) {
                    clearInterval(interval);
                    document.getElementById('resultContent').innerHTML = `
                        <p>工作流执行完成！</p>
                        <ul>
                            <li>开始事件: 已完成</li>
                            <li>任务1: 已完成</li>
                            <li>结束事件: 已完成</li>
                        </ul>
                        <p>总执行时间: 5秒</p>
                        <p>状态: 成功</p>
                    `;
                }
            }, 1000);
        }

        // 二维码生成功能
        function generateQRCode() {
            const content = document.getElementById('qrContent').value;
            const size = parseInt(document.getElementById('qrSize').value);

            if (!content) {
                alert('请输入二维码内容');
                return;
            }

            const qrContainer = document.getElementById('qrResult');
            const qrElement = document.getElementById('qrcode');

            // 清空之前的二维码
            qrElement.innerHTML = '';

            // 生成二维码
            new QRCode(qrElement, {
                text: content,
                width: size,
                height: size,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            qrContainer.style.display = 'block';
        }

        // 下载二维码
        function downloadQRCode() {
            const canvas = document.querySelector('#qrcode canvas');
            if (!canvas) {
                alert('请先生成二维码');
                return;
            }

            const link = document.createElement('a');
            link.download = 'qrcode.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // 图片压缩功能
        function compressImage() {
            const fileInput = document.getElementById('compressImage');
            const quality = parseFloat(document.getElementById('qualityLevel').value);

            if (!fileInput.files || fileInput.files.length === 0) {
                alert('请上传图片');
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                const img = new Image();
                img.src = e.target.result;

                img.onload = function () {
                    // 显示原始图片
                    document.getElementById('originalPreview').src = img.src;
                    document.getElementById('originalSize').textContent = `尺寸: ${img.width}x${img.height} | 大小: ${formatFileSize(file.size)}`;

                    // 创建Canvas进行压缩
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;

                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    // 获取压缩后的数据URL
                    const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);

                    // 显示压缩后的图片
                    document.getElementById('compressedPreview').src = compressedDataUrl;

                    // 计算压缩后的大小
                    const compressedSize = Math.round((compressedDataUrl.length - 'data:image/jpeg;base64,'.length) * 3 / 4);
                    document.getElementById('compressedSize').textContent = `尺寸: ${img.width}x${img.height} | 大小: ${formatFileSize(compressedSize)}`;

                    // 保存压缩后的数据URL供下载使用
                    document.getElementById('compressedPreview').dataset.url = compressedDataUrl;

                    // 显示结果
                    document.getElementById('compressionResult').style.display = 'flex';
                };
            };

            reader.readAsDataURL(file);
        }

        // 下载压缩后的图片
        function downloadCompressedImage() {
            const dataUrl = document.getElementById('compressedPreview').dataset.url;
            if (!dataUrl) {
                alert('请先生成压缩图片');
                return;
            }

            const link = document.createElement('a');
            link.download = 'compressed_image.jpg';
            link.href = dataUrl;
            link.click();
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
            else return (bytes / 1048576).toFixed(2) + ' MB';
        }

        // 生成短链
        function generateShortUrl() {
            const longUrl = document.getElementById('longUrl').value;
            const customAlias = document.getElementById('customAlias').value;

            if (!longUrl) {
                alert('请输入长URL');
                return;
            }

            // 生成短链（前端模拟）
            let shortUrl;
            if (customAlias) {
                shortUrl = window.location.origin + '/s/' + customAlias;
            } else {
                // 生成随机短码
                const shortCode = Math.random().toString(36).substring(2, 8);
                shortUrl = window.location.origin + '/s/' + shortCode;
            }

            // 存储映射关系到localStorage
            const urlMappings = JSON.parse(localStorage.getItem('urlMappings') || '{}');
            urlMappings[shortUrl] = longUrl;
            localStorage.setItem('urlMappings', JSON.stringify(urlMappings));

            // 显示短链
            document.getElementById('shortUrl').textContent = shortUrl;
            document.getElementById('shortenerResult').style.display = 'block';
        }

        // 复制短链
        function copyShortUrl() {
            const shortUrl = document.getElementById('shortUrl').textContent;
            if (!shortUrl) {
                alert('请先生成短链');
                return;
            }

            navigator.clipboard.writeText(shortUrl)
                .then(() => {
                    alert('短链已复制到剪贴板');
                })
                .catch(err => {
                    console.error('复制失败:', err);
                    alert('复制失败，请手动复制');
                });
        }

        // 短链重定向（在页面加载时检查）
        function checkShortUrl() {
            const path = window.location.pathname;
            if (path.startsWith('/s/')) {
                const shortCode = path.substring(3);
                const shortUrl = window.location.origin + '/s/' + shortCode;

                const urlMappings = JSON.parse(localStorage.getItem('urlMappings') || '{}');
                const longUrl = urlMappings[shortUrl];

                if (longUrl) {
                    window.location.href = longUrl;
                } else {
                    alert('短链接不存在或已过期');
                }
            }
        }

        // 页面加载时检查短链
        window.onload = checkShortUrl;
        function convertVideo2() {
            alert('视频转换功能需要后端支持，将在后续版本实现');
        }
        // 其他功能实现保持不变...
    </script>
</body>

</html>